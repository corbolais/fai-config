#!/usr/bin/env bash

error=0; trap 'error=$(($?>$error?$?:$error))' ERR; # save maximum error code

# set root password
if [ -n "$ROOTPW" ]; then
  $ROOTCMD usermod -p "$ROOTPW" root;
else
  $ROOTCMD usermod -L root;
  # shellcheck disable=SC2154
  if test -n "$username"; then
    # enable sudo for user
    mkdir -p /etc/sudoers.d/;
    ainsl -a /etc/sudoers.d/01-localuser "$username   ALL = ALL";
  else
    echo "$0: ERR: Sorry, no username specified. This setup is unusable without username to log in with.";
    exit 128;
  fi;
fi;

exit "$error";

### EOF
